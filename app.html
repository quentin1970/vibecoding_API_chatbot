<html>
<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ğŸµ Mood Music â€“ Demo (Fixed)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg: #0f172a;
            --card: #111827;
            --text: #e5e7eb;
            --accent: #8b5cf6
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #0f172a, #111827);
            color: var(--text);
            font-family: Poppins, system-ui, sans-serif
        }

        .container {
            max-width: 980px;
            margin: 40px auto;
            padding: 0 20px
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px
        }

        .brand {
            font-weight: 700;
            font-size: 24px;
            letter-spacing: .5px
        }

        .card {
            background: rgba(17, 24, 39, .7);
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 20px;
            padding: 20px
        }

        .row {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
            align-items: center
        }

        .btn {
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, .1);
            background: var(--accent);
            color: var(--text);
            font-weight: 600;
            cursor: pointer
        }

        .btn-link {
            display: inline-block;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, .2);
            padding: 8px 12px;
            border-radius: 10px;
            color: var(--text);
            text-decoration: none
        }

        .pill {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            background: #2a2f45;
            border: 1px solid rgba(255, 255, 255, .08);
            font-size: 12px;
            margin-right: 6px
        }

        .mood-bar {
            display: flex;
            gap: 10px;
            flex-wrap: wrap
        }

        .mood-btn {
            padding: 10px 12px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, .12);
            background: #0b1020;
            color: var(--text);
            cursor: pointer;
            font-weight: 600
        }

        .mood-btn.active {
            background: var(--accent);
            border-color: transparent
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 18px
        }

        .media-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 18px
        }

        @media (max-width: 900px) {
            .media-row {
                grid-template-columns: 1fr
            }
        }

        .sp-embed {
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, .08);
            background: #0b1020
        }

        .sp-embed iframe {
            width: 100%;
            height: 380px;
            border: 0
        }

        .yt-wrap {
            position: relative;
            padding-top: 56.25%;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, .08);
            background: #0b1020
        }

        .yt-wrap iframe {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%
        }

        .yt-thumbs {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 12px
        }

        .yt-thumbs.two-col {
            grid-template-columns: 1fr 1fr
        }

        .yt-col {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px
        }

        .yt-thumb {
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 12px;
            overflow: hidden;
            background: #0b1020
        }

        .yt-thumb img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        .yt-thumb .cap {
            padding: 8px;
            font-size: 12px;
            opacity: .85
        }

        .cal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px
        }

        .cal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px
        }

        .cal-cell {
            aspect-ratio: 1/1.05;
            min-height: 88px;
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 10px;
            padding: 8px;
            background: #0b1020;
            position: relative
        }

        .cal-day {
            opacity: .9;
            font-size: 12px
        }

        .cal-has {
            position: absolute;
            right: 8px;
            bottom: 8px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981
        }

        .cal-empty {
            opacity: .25
        }

        .cal-snippet {
            margin-top: 6px;
            font-size: 11px;
            opacity: .75;
            line-height: 1.2;
            max-height: 2.4em;
            overflow: hidden
        }

        .memo {
            margin-top: 14px;
            display: flex;
            flex-direction: column;
            gap: 10px
        }

        .textarea {
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, .12);
            background: #0b1020;
            color: var(--text)
        }

        .footer {
            opacity: .7;
            margin-top: 28px;
            font-size: 13px;
            text-align: center
        }

        @media (max-width: 640px) {
            .grid {
                grid-template-columns: 1fr
            }

            .mood-btn {
                padding: 12px 14px
            }

            .card {
                padding: 16px
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="brand">ğŸµ Mood Music (Demo)</div>
            <a class="btn-link" href="./README.md" target="_blank" rel="noreferrer">í”„ë¡œì íŠ¸ ì„¤ëª… ì—´ê¸°</a>
        </div>

        <div class="card">
            <div class="row">
                <div class="mood-bar" id="mood-bar">
                    <button class="mood-btn" data-mood="í–‰ë³µ">ğŸ˜Š í–‰ë³µ</button>
                    <button class="mood-btn" data-mood="ìŠ¬í””">ğŸ˜¢ ìŠ¬í””</button>
                    <button class="mood-btn" data-mood="ìŠ¤íŠ¸ë ˆìŠ¤">ğŸ˜µ ìŠ¤íŠ¸ë ˆìŠ¤</button>
                    <button class="mood-btn" data-mood="ì°¨ë¶„">ğŸ˜Œ ì°¨ë¶„</button>
                    <button class="mood-btn" data-mood="ì§‘ì¤‘">ğŸ§  ì§‘ì¤‘</button>
                    <button class="mood-btn" data-mood="ì‹ ë‚¨">ğŸ¤© ì‹ ë‚¨</button>
                    <button class="mood-btn" data-mood="ë¡œë§¨í‹±">ğŸ’– ë¡œë§¨í‹±</button>
                    <button class="mood-btn" data-mood="ìš´ë™">ğŸ’ª ìš´ë™</button>
                    <button class="mood-btn" data-mood="ê¸°ë¶„ì „í™˜">ğŸŒˆ ê¸°ë¶„ì „í™˜</button>
                    <button class="mood-btn" data-mood="ì¹ í™">ğŸ§Š ì¹ í™</button>
                </div>
                <span id="status" class="pill" style="display:none"></span>
            </div>
        </div>

        <div id="media-row" class="media-row" style="display:none">
            <div id="result" class="card" style="display:none">
                <h3 style="margin-top:0">Spotify í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</h3>
                <div id="grid" class="grid"></div>
            </div>
            <div id="yt" class="card" style="display:none">
                <h3 style="margin-top:0">YouTube ì¶”ì²œ ì˜ìƒ</h3>
                <div class="yt-wrap"><iframe id="yt-frame" src="" title="YouTube video" frameborder="0"
                        allow="autoplay; accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe></div>
                <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
                    <a id="yt-link" class="btn-link" href="#" target="_blank" rel="noreferrer">YouTubeì—ì„œ ì—´ê¸°</a>
                    <span class="pill">ì²« ì˜ìƒì€ ë¬´ìŒ ìë™ì¬ìƒë©ë‹ˆë‹¤</span>
                </div>
                <div id="yt-thumbs" class="yt-thumbs"></div>
            </div>
        </div>

        <div id="art" class="card" style="display:none">
            <h3 style="margin-top:0">ì˜¤ëŠ˜ì˜ ì˜ˆìˆ  ì‘í’ˆ</h3>
            <img id="art-img" src="" alt="art"
                style="width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.08)" />
            <div id="art-cap" class="meta" style="margin-top:8px"></div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
                <a id="art-open" class="btn-link" href="#" target="_blank" rel="noreferrer">ì‘í’ˆ í˜ì´ì§€ ì—´ê¸°</a>
                <button id="art-embed-toggle" class="btn" style="background:#6b7280">ì„ë² ë“œ ë³´ê¸°</button>
            </div>
            <div id="art-sources" class="meta" style="margin-top:8px"></div>
            <div id="art-embed-wrap"
                style="display:none;margin-top:10px;border:1px solid rgba(255,255,255,.08);border-radius:12px;overflow:hidden;background:#0b1020">
                <iframe id="art-embed" src="" style="width:100%;height:420px;border:0" title="art page"></iframe>
            </div>
            <div id="art-embed-note" class="meta" style="display:none;margin-top:6px">ì¼ë¶€ ë¯¸ìˆ ê´€ ì‚¬ì´íŠ¸ëŠ” ë³´ì•ˆ
                ì •ì±…(X-Frame-Options)ìœ¼ë¡œ ì„ë² ë“œê°€ ì°¨ë‹¨ë©ë‹ˆë‹¤. ì´ ê²½ìš° ìœ„ ë§í¬ë¡œ ìƒˆ íƒ­ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”.</div>
        </div>

        <div id="diary" class="card diary">
            <h3 style="margin-top:0">ë‚˜ì˜ ê¸°ë¶„ ì¼ê¸° (ë‹¬ë ¥)</h3>
            <div class="cal-header">
                <button id="prev-week" class="btn" style="padding:8px 10px">â—€</button>
                <div id="cal-title" class="brand" style="font-size:18px">ì´ë²ˆ ì£¼</div>
                <button id="next-week" class="btn" style="padding:8px 10px">â–¶</button>
            </div>
            <div class="cal-grid" id="cal-grid"></div>
            <div class="memo">
                <div style="display:flex;gap:10px;align-items:center"><span class="pill" id="memo-date">ë‚ ì§œë¥¼
                        ì„ íƒí•˜ì„¸ìš”</span><span class="pill" id="memo-mood" style="display:none"></span></div>
                <textarea id="memo-text" class="textarea" rows="3" placeholder="ê°„ë‹¨í•œ ë©”ëª¨ë¥¼ ì ì–´ ë³´ì„¸ìš”"></textarea>
                <div style="display:flex;gap:10px;flex-wrap:wrap">
                    <button id="memo-save" class="btn">ë©”ëª¨ ì €ì¥</button>
                    <button id="memo-clear" class="btn" style="background:#ef4444">ì‚­ì œ</button>
                    <button id="export-json" class="btn" style="background:#0ea5e9">JSON ë‚´ë³´ë‚´ê¸°</button>
                    <button id="export-csv" class="btn" style="background:#22c55e">CSV ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>
        </div>

        <div id="code" class="card" style="display:none">
            <h3 style="margin-top:0">ì½”ë“œ ìŠ¤ë‹ˆí«</h3>
            <textarea id="code-text" class="textarea" rows="5" placeholder="ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ ì½”ë“œê°€ ì±„ì›Œì§‘ë‹ˆë‹¤"></textarea>
            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
                <button id="code-run" class="btn">ì‹¤í–‰</button>
                <button id="code-clear" class="btn" style="background:#6b7280">ì§€ìš°ê¸°</button>
            </div>
            <pre id="code-out" class="textarea" style="white-space:pre-wrap;margin-top:10px"></pre>
        </div>
    </div>

    <div class="footer"> 2025 Mood Music Demo</div>
    </div>

    <script>
        const $ = (s) => document.querySelector(s);
        let selectedMood = 'í–‰ë³µ';
        const moodBarEl = $('#mood-bar');
        const statusEl = $('#status');
        const resultEl = $('#result');
        const gridEl = $('#grid');
        const mediaRow = $('#media-row');
        const ytCard = $('#yt');
        const ytFrame = $('#yt-frame');
        const ytLink = $('#yt-link');
        const ytThumbs = $('#yt-thumbs');
        const artCard = $('#art');
        const artImg = $('#art-img');
        const artCap = $('#art-cap');
        const artOpen = $('#art-open');
        const artEmbedToggle = $('#art-embed-toggle');
        const artSources = $('#art-sources');
        const artEmbedWrap = $('#art-embed-wrap');
        const artEmbed = $('#art-embed');
        const artEmbedNote = $('#art-embed-note');
        let currentArtPages = [];

        const SPOTIFY_PLAYLIST_BY_MOOD = {
            'í–‰ë³µ': '37i9dQZF1DXdPec7aLTmlC',
            'ìŠ¬í””': '37i9dQZF1DX7qK8ma5wgG1',
            'ìŠ¤íŠ¸ë ˆìŠ¤': '37i9dQZF1DX3Ogo9pFvBkY',
            'ì°¨ë¶„': '37i9dQZF1DX4sWSpwq3LiO',
            'ì§‘ì¤‘': '37i9dQZF1DX8Uebhn9wzrS',
            'ì‹ ë‚¨': '37i9dQZF1DX1H4LbvY4OJI',
            'ë¡œë§¨í‹±': '37i9dQZF1DWXJfnUiYjUKT',
            'ìš´ë™': '37i9dQZF1DX76Wlfdnj7AP',
            'ê¸°ë¶„ì „í™˜': '37i9dQZF1DX3rxVfibe1L0',
            'ì¹ í™': '37i9dQZF1DX4WYpdgoIcn6'
        };

        const ART_BY_MOOD = {
            'í–‰ë³µ': {
                title: 'ê³ í â€“ í•´ë°”ë¼ê¸°', desc: 'ë”°ëœ»í•œ ë…¸ë€ìƒ‰ê³¼ í™œë ¥ ë„˜ì¹˜ëŠ” ë¶“ì§ˆì€ ê¸ì •ê³¼ í™œê¸°ë¥¼ ì „í•©ë‹ˆë‹¤. ë°ì€ í†¤ì´ í–‰ë³µí•œ ê¸°ë¶„ì„ ë”ìš± ì¦í­ì‹œì¼œ ì¤ë‹ˆë‹¤.',
                srcs: [
                    'https://images.metmuseum.org/CRDImages/ep/original/DP229743.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/the-sunflowers-1888-1.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/6/6a/Vincent_van_Gogh_-_Sunflowers_-_VGM_F458.jpg'
                ],
                pages: [
                    'https://www.metmuseum.org/art/collection',
                    'https://artsandculture.google.com/?hl=ko',
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko'
                ]
            },
            'ìŠ¬í””': {
                title: 'ë­‰í¬ â€“ ì ˆê·œ', desc: 'ë’¤í‹€ë¦° í•˜ëŠ˜ê³¼ ì¸ë¬¼ì˜ í‘œì •ì´ ê°ì •ì˜ ë²ˆì§ì„ ì‹œê°í™”í•©ë‹ˆë‹¤. ìŠ¬í””ê³¼ ë¶ˆì•ˆì„ ì •ë©´ìœ¼ë¡œ ë§ˆì£¼í•˜ê²Œ í•©ë‹ˆë‹¤.',
                srcs: [
                    'https://upload.wikimedia.org/wikipedia/commons/f/f4/The_Scream.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/the-scream-1893-1.jpg'
                ],
                pages: [
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko',
                    'https://artsandculture.google.com/?hl=ko'
                ]
            },
            'ìŠ¤íŠ¸ë ˆìŠ¤': {
                title: 'í˜¸ì¿ ì‚¬ì´ â€“ ê°€ë‚˜ê°€ì™€ì˜ í° íŒŒë„', desc: 'ê±°ëŒ€í•œ ë¬¼ê²°ì€ ì••ë„ì™€ ê¸´ì¥ì„ ìƒì§•í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë’¤í¸ í›„ì§€ì‚°ì€ í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ì¤‘ì‹¬ì„ ì•”ì‹œí•©ë‹ˆë‹¤.',
                srcs: [
                    'https://upload.wikimedia.org/wikipedia/commons/0/0a/Great_Wave_off_Kanagawa2.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/the-great-wave-off-kanagawa-1830-1.jpg'
                ],
                pages: [
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko',
                    'https://www.metmuseum.org/art/collection'
                ]
            },
            'ì°¨ë¶„': {
                title: 'ëª¨ë„¤ â€“ ìˆ˜ë ¨', desc: 'ë¶€ë“œëŸ¬ìš´ ìƒ‰ë©´ê³¼ ì”ì”í•œ ìˆ˜ë©´ì´ ì‹¬í˜¸í¡ì„ ì´ë•ë‹ˆë‹¤. ì‹œì„ ì´ ë¨¸ë¬´ëŠ” ë™ì•ˆ ë§ˆìŒì˜ íŒŒì¥ë„ ì¦ì•„ë“­ë‹ˆë‹¤.',
                srcs: [
                    'https://images.metmuseum.org/CRDImages/ep/original/DT1567.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/water-lilies-1919-1.jpg',
                    'https://upload.wikimedia.org/wikipedia/commons/0/09/Claude_Monet_-_Water_Lilies_-_Google_Art_Project.jpg'
                ],
                pages: [
                    'https://www.metmuseum.org/art/collection',
                    'https://artsandculture.google.com/?hl=ko',
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko'
                ]
            },
            'ì§‘ì¤‘': {
                title: 'ëª¬ë“œë¦¬ì•ˆ â€“ êµ¬ì„±', desc: 'ëª…í™•í•œ ê²©ìì™€ ìƒ‰ë©´ì˜ ì§ˆì„œê°€ ì¸ì§€ì  ì´ˆì ì„ ë•ìŠµë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ìš”ì†Œë¥¼ ëœì–´ë‚¸ ì ˆì œê°€ ì§‘ì¤‘ì„ ê°•í™”í•©ë‹ˆë‹¤.',
                srcs: [
                    'https://upload.wikimedia.org/wikipedia/commons/5/5f/Piet_Mondrian%2C_1921_-_Composition_with_large_red_plane%2C_yellow%2C_black%2C_gray_and_blue.jpg'
                ],
                pages: [
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko'
                ]
            },
            'ì‹ ë‚¨': {
                title: 'ì¹¸ë”˜ìŠ¤í‚¤ â€“ êµ¬ì„± VII', desc: 'ì„ ê³¼ ìƒ‰ì˜ í­ë°œì  ì—ë„ˆì§€ê°€ í¥ë¶„ê³¼ ì—­ë™ì„ ì „ë‹¬í•©ë‹ˆë‹¤. ì¦‰í¥ì  ë¦¬ë“¬ì´ ì‹ ë‚˜ëŠ” ê°ì •ì„ ì£¼íŒŒìˆ˜ì²˜ëŸ¼ ìš¸ë¦½ë‹ˆë‹¤.',
                srcs: [
                    'https://upload.wikimedia.org/wikipedia/commons/3/32/Wassily_Kandinsky%2C_1913_-_Composition_7.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/composition-vii-1913-1.jpg'
                ],
                pages: [
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko'
                ]
            },
            'ë¡œë§¨í‹±': {
                title: 'í´ë¦¼íŠ¸ â€“ í‚¤ìŠ¤', desc: 'í™©ê¸ˆë¹› ì¥ì‹ì„±ê³¼ ì„œë¡œë¥¼ ê°ì‹¸ëŠ” êµ¬ë„ê°€ ì¹œë°€í•¨ì„ ê°•ì¡°í•©ë‹ˆë‹¤. ë¶€ë“œëŸ¬ìš´ ê³¡ì„ ì´ ì‚¬ë‘ì˜ ì˜¨ê¸°ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.',
                srcs: [
                    'https://upload.wikimedia.org/wikipedia/commons/0/0c/Gustav_Klimt_016.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/the-kiss-1907-1.jpg'
                ],
                pages: [
                    'https://artsandculture.google.com/?hl=ko',
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko'
                ]
            },
            'ìš´ë™': {
                title: 'ë³´ì´ˆë‹ˆ â€“ ìì „ê±° íƒ„ ì´ì˜ ì—­ë™', desc: 'ì†ë„ê° ìˆëŠ” ì„ ê³¼ í˜•íƒœ ë¶„ì ˆì´ ìš´ë™ ì—ë„ˆì§€ë¥¼ í¬ì°©í•©ë‹ˆë‹¤. ì‹ ì²´ì˜ ì¶”ì§„ë ¥ì´ í™”ë©´ ì „ì²´ë¡œ í™•ì¥ë©ë‹ˆë‹¤.',
                srcs: [
                    'https://upload.wikimedia.org/wikipedia/commons/8/8d/Umberto_Boccioni%2C_1913%2C_Dynamism_of_a_Cyclist.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/dynamism-of-a-cyclist-1913-1.jpg'
                ],
                pages: [
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko'
                ]
            },
            'ê¸°ë¶„ì „í™˜': {
                title: 'ë§ˆí‹°ìŠ¤ â€“ ë¶‰ì€ ë°©ì˜ ì¡°í™”', desc: 'ê°•ë ¬í•œ ìƒ‰ë©´ ì „í™˜ì´ ì¸ì§€ì˜ í‹€ì„ í”ë“­ë‹ˆë‹¤. ìƒë™í•˜ëŠ” íŒ¨í„´ì´ ê¸°ë¶„ì„ ìƒˆë¡­ê²Œ í™˜ê¸°í•©ë‹ˆë‹¤.',
                srcs: [
                    'https://upload.wikimedia.org/wikipedia/commons/3/34/Henri_Matisse%2C_1909%2C_Harmony_in_Red_%28The_Red_Room%29.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/harmony-in-red-the-red-room-1903-1.jpg'
                ],
                pages: [
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko',
                    'https://www.artic.edu/collection'
                ]
            },
            'ì¹ í™': {
                title: 'íœ˜ìŠ¬ëŸ¬ â€“ ì•¼ìƒê³¡', desc: 'ì–´ë‘  ì† ì ë¬˜ì  ë¶ˆë¹›ì´ ì°¨ê°‘ê³ ë„ ê³ ìš”í•œ ë°¤ì„ ë§Œë“­ë‹ˆë‹¤. ëŠë¦° ì”í–¥ì´ ì°¨ë¶„í•œ ì¿¨ê°ì„ ë‚¨ê¹ë‹ˆë‹¤.',
                srcs: [
                    'https://upload.wikimedia.org/wikipedia/commons/6/62/James_McNeill_Whistler_-_Nocturne_in_Black_and_Gold%2C_The_Falling_Rocket.jpg',
                    'https://artvee.com/wp-content/uploads/2020/09/nocturne-in-black-and-gold-the-falling-rocket-1874-1.jpg'
                ],
                pages: [
                    'https://commons.wikimedia.org/wiki/Main_Page?uselang=ko'
                ]
            }
        };

        function loadArt(mood) {
            const art = ART_BY_MOOD[mood];
            if (!art) { artCard.style.display = 'none'; return; }
            const srcs = art.srcs.slice();
            function tryNext() {
                if (!srcs.length) { artCard.style.display = 'none'; return; }
                const src = srcs.shift();
                artImg.onerror = () => { tryNext(); };
                artImg.onload = () => { artCard.style.display = 'block'; };
                artImg.src = src; artImg.alt = art.title; artCap.innerHTML = `<strong>${art.title}</strong><br>${art.desc}`;
                // sources and open link
                const pages = art.pages || [];
                if (pages.length) {
                    artOpen.href = pages[0];
                    artSources.innerHTML = 'ì¶œì²˜: ' + pages.map((p, i) => `<a class="btn-link" href="${p}" target="_blank" rel="noreferrer">ë§í¬${i + 1}</a>`).join(' ');
                } else {
                    artOpen.href = '#';
                    artSources.textContent = '';
                }
            }
            tryNext();
        }

        function firstEmbeddableUrl(pages) {
            const allowHosts = ['commons.wikimedia.org', 'www.artic.edu', 'pixabay.com'];
            for (const p of (pages || [])) {
                try { const u = new URL(p); if (allowHosts.includes(u.host)) return p; } catch (e) { }
            }
            return '';
        }

        artEmbedToggle.addEventListener('click', () => {
            if (!currentArtPages.length) { artEmbedWrap.style.display = 'none'; artEmbedNote.style.display = 'block'; return; }
            if (artEmbedWrap.style.display === 'none' || !artEmbedWrap.style.display) {
                const u = firstEmbeddableUrl(currentArtPages);
                if (u) { artEmbed.src = u; artEmbedWrap.style.display = 'block'; artEmbedNote.style.display = 'none'; }
                else { artEmbedWrap.style.display = 'none'; artEmbedNote.style.display = 'block'; if (currentArtPages[0]) window.open(currentArtPages[0], '_blank'); }
            } else {
                artEmbedWrap.style.display = 'none';
            }
        });

        const MOOD_META = {
            'í–‰ë³µ': { emoji: 'ğŸ˜Š', color: '#f59e0b' },
            'ìŠ¬í””': { emoji: 'ğŸ˜¢', color: '#60a5fa' },
            'ìŠ¤íŠ¸ë ˆìŠ¤': { emoji: 'ğŸ˜µ', color: '#a78bfa' },
            'ì°¨ë¶„': { emoji: 'ğŸ˜Œ', color: '#34d399' },
            'ì§‘ì¤‘': { emoji: 'ğŸ§ ', color: '#f97316' },
            'ì‹ ë‚¨': { emoji: 'ğŸ¤©', color: '#ef4444' },
            'ë¡œë§¨í‹±': { emoji: 'ğŸ’–', color: '#fb7185' },
            'ìš´ë™': { emoji: 'ğŸ’ª', color: '#22c55e' },
            'ê¸°ë¶„ì „í™˜': { emoji: 'ğŸŒˆ', color: '#38bdf8' },
            'ì¹ í™': { emoji: 'ğŸ§Š', color: '#93c5fd' }
        };

        const YT_BY_MOOD = {
            'í–‰ë³µ': [
                { id: 'ZbZSe6N_BXs', title: 'Pharrell Williams - Happy' },
                { id: 'pRpeEdMmmQ0', title: 'Shakira - Waka Waka' },
                { id: 'OPf0YbXqDm0', title: 'Mark Ronson - Uptown Funk' }
            ],
            'ìŠ¬í””': [
                { id: 'hLQl3WQQoQ0', title: 'Adele - Someone Like You' },
                { id: 'RgKAFK5djSk', title: 'Wiz Khalifa - See You Again' },
                { id: 'pbMwTqkKSps', title: 'Sam Smith - Too Good At Goodbyes' }
            ],
            'ìŠ¤íŠ¸ë ˆìŠ¤': [
                { id: '2OEL4P1Rz04', title: 'Calm Music - Stress Relief' },
                { id: 'DWcJFNfaw9c', title: 'Lofi Hip Hop - relax' },
                { id: '2X_2IdybTV0', title: 'Deep Focus Music' }
            ],
            'ì°¨ë¶„': [
                { id: '1ZYbU82GVz4', title: 'Peaceful Piano' },
                { id: '2OEL4P1Rz04', title: 'Relaxing Music' },
                { id: '7NOSDKb0HlU', title: 'Ambient Chillout' }
            ],
            'ì§‘ì¤‘': [
                { id: 'WPni755-Krg', title: 'lofi hip hop radio' },
                { id: 'lTRiuFIWV54', title: '4 Hours Focus' },
                { id: '2X_2IdybTV0', title: 'Deep Focus' }
            ],
            'ì‹ ë‚¨': [
                { id: 'tVj0ZTS4WF4', title: 'Jennifer Lopez - On The Floor' },
                { id: '9bZkp7q19f0', title: 'PSY - GANGNAM STYLE' },
                { id: 'uelHwf8o7_U', title: 'Eminem - Love The Way You Lie' }
            ],
            'ë¡œë§¨í‹±': [
                { id: '450p7goxZqg', title: 'Ed Sheeran - Thinking Out Loud' },
                { id: 'JGwWNGJdvx8', title: 'Ed Sheeran - Shape of You' },
                { id: 'nSDgHBxUbVQ', title: 'Ed Sheeran - Perfect' }
            ],
            'ìš´ë™': [
                { id: 'gCYcHz2k5x0', title: 'Calvin Harris - Summer' },
                { id: 'fJ9rUzIMcZQ', title: "Queen â€“ Don't Stop Me Now" },
                { id: 'JRfuAukYTKg', title: 'Calvin Harris - Feel So Close' }
            ],
            'ê¸°ë¶„ì „í™˜': [
                { id: 'OPf0YbXqDm0', title: 'Mark Ronson - Uptown Funk' },
                { id: '09R8_2nJtjg', title: 'Maroon 5 - Sugar' },
                { id: '3AtDnEC4zak', title: "Charlie Puth - We Don't Talk Anymore" }
            ],
            'ì¹ í™': [
                { id: '5qap5aO4i9A', title: 'lofi hip hop radio' },
                { id: 'DWcJFNfaw9c', title: 'Lofi Hip Hop Radio' },
                { id: '7NOSDKb0HlU', title: 'Ambient Chillout' }
            ]
        };

        function setStatus(text) {
            if (!statusEl) return; if (!text) { statusEl.style.display = 'none'; statusEl.textContent = ''; return; }
            statusEl.textContent = text; statusEl.style.display = 'inline-block';
        }

        function setMood(m) {
            selectedMood = m;
            document.querySelectorAll('.mood-btn').forEach(b => {
                b.classList.toggle('active', b.getAttribute('data-mood') === m);
            });
            const mm = $('#memo-mood'); if (mm) { mm.textContent = `í˜„ì¬ ê¸°ë¶„: ${m}`; mm.style.display = 'inline-block'; }
        }

        function renderYouTubeCandidates(mood) {
            const arr = (YT_BY_MOOD[mood] || []).slice(0, 2); // only 2 recommendations
            ytThumbs.innerHTML = '';
            ytCard.style.display = arr.length ? 'block' : 'none';
            // auto-play first candidate muted
            if (arr.length) {
                const first = arr[0];
                ytLink.href = `https://youtu.be/${first.id}`;
                // set src on next frame to reduce autoplay race conditions
                requestAnimationFrame(() => {
                    ytFrame.src = `https://www.youtube.com/embed/${first.id}?autoplay=1&mute=1&playsinline=1&rel=0`;
                });
            } else {
                ytFrame.src = '';
            }
            // build two thumbnails max
            ytThumbs.classList.remove('two-col');
            arr.forEach(v => {
                const d = document.createElement('div'); d.className = 'yt-thumb';
                d.innerHTML = `<img src="https://i.ytimg.com/vi/${v.id}/hqdefault.jpg" alt="${v.title}"><div class="cap">${v.title}</div>`;
                d.addEventListener('click', () => { ytFrame.src = `https://www.youtube.com/embed/${v.id}?autoplay=1&mute=1&playsinline=1&rel=0`; ytLink.href = `https://youtu.be/${v.id}`; });
                ytThumbs.appendChild(d);
            });
        }

        function recommendForMood(mood) {
            setStatus('í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ êµ¬ì„± ì¤‘â€¦');
            const pid = SPOTIFY_PLAYLIST_BY_MOOD[mood];
            gridEl.innerHTML = '';
            if (pid) {
                const wrap = document.createElement('div'); wrap.className = 'sp-embed';
                wrap.innerHTML = `<iframe src="https://open.spotify.com/embed/playlist/${pid}" loading="lazy" allow="autoplay; encrypted-media"></iframe>`;
                gridEl.appendChild(wrap);
                resultEl.style.display = 'block';
            } else { resultEl.style.display = 'none'; }
            // show both panes together
            mediaRow.style.display = 'grid';
            renderYouTubeCandidates(mood);
            // render art with fallback chain
            loadArt(mood);
            setStatus('ì™„ë£Œ'); setTimeout(() => setStatus(''), 800);
        }

        moodBarEl.addEventListener('click', (e) => {
            const b = e.target.closest('.mood-btn'); if (!b) return; const m = b.getAttribute('data-mood'); setMood(m); recommendForMood(m);
        });

        // Calendar + memo
        const calGrid = $('#cal-grid'); const calTitle = $('#cal-title'); const memoDate = $('#memo-date'); const memoText = $('#memo-text');
        const memoSave = $('#memo-save'); const memoClear = $('#memo-clear');
        const codeCard = $('#code'); const codeText = $('#code-text'); const codeRun = $('#code-run'); const codeClear = $('#code-clear'); const codeOut = $('#code-out');
        let calYear, calMonth; let selectedDateISO = '';
        let anchorDate = new Date();

        function getMemoMap() { return JSON.parse(localStorage.getItem('mood_diary_memos') || '{}'); }
        function setMemo(dateISO, memo) { const map = getMemoMap(); if (memo) map[dateISO] = memo; else delete map[dateISO]; localStorage.setItem('mood_diary_memos', JSON.stringify(map)); }
        function getMemo(dateISO) { const map = getMemoMap(); const v = map[dateISO]; if (!v) return { text: '', mood: '' }; if (typeof v === 'string') return { text: v, mood: '' }; return { text: v.text || '', mood: v.mood || '' }; }
        function ymdISO(y, m, d) { const mm = String(m + 1).padStart(2, '0'); const dd = String(d).padStart(2, '0'); return `${y}-${mm}-${dd}`; }

        function renderCalendar() {
            calGrid.innerHTML = '';
            calTitle.textContent = 'ì´ë²ˆ ì£¼';
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            weekdays.forEach(w => { const h = document.createElement('div'); h.textContent = w; h.className = 'pill'; calGrid.appendChild(h); });
            const startOfWeek = new Date(anchorDate.getFullYear(), anchorDate.getMonth(), anchorDate.getDate() - anchorDate.getDay()); // Sunday
            const memoMap = getMemoMap();
            for (let i = 0; i < 7; i++) {
                const d = new Date(startOfWeek.getFullYear(), startOfWeek.getMonth(), startOfWeek.getDate() + i);
                const c = document.createElement('div'); c.className = 'cal-cell';
                const p = document.createElement('div'); p.className = 'cal-day'; p.textContent = d.getDate(); c.appendChild(p);
                const iso = ymdISO(d.getFullYear(), d.getMonth(), d.getDate());
                if (memoMap[iso]) {
                    const dot = document.createElement('div'); dot.className = 'cal-has'; c.appendChild(dot);
                    const val = getMemo(iso); c.title = val.text || '';
                    const meta = MOOD_META[val.mood]; if (meta) { p.textContent = `${d.getDate()} ${meta.emoji}`; c.style.borderColor = meta.color + '80'; }
                    const snip = document.createElement('div'); snip.className = 'cal-snippet'; snip.textContent = (val.text || '').split('\n')[0].slice(0, 18); c.appendChild(snip);
                }
                c.addEventListener('click', () => {
                    selectedDateISO = iso; memoDate.textContent = iso; const cur = getMemo(iso); memoText.value = cur.text || ''; if (cur.mood) { setMood(cur.mood); }
                    const mlabel = selectedMood;
                    codeText.value = `// ${iso} - ${mlabel}\nconst date = '${iso}';\nconst mood = '${mlabel}';\nconst tip = ['ì‹¬í˜¸í¡ 5íšŒ', 'ì‚°ì±… 10ë¶„', 'ë¬¼ í•œ ì”', 'ìŠ¤íŠ¸ë ˆì¹­ 3ë¶„'][Math.floor(Math.random() * 4)];\nconsole.log(\`ì˜¤ëŠ˜(${'${'}date}) ê¸°ë¶„: ${'${'}mood}\`);\nconsole.log(\`ì¶”ì²œ ì•¡ì…˜: ${'${'}tip}\`);`;
                    codeOut.textContent = ''; codeCard.style.display = 'block';
                });
                calGrid.appendChild(c);
            }
        }

        // week navigation
        $('#prev-week').addEventListener('click', () => { anchorDate = new Date(anchorDate.getFullYear(), anchorDate.getMonth(), anchorDate.getDate() - 7); renderCalendar(); });
        $('#next-week').addEventListener('click', () => { anchorDate = new Date(anchorDate.getFullYear(), anchorDate.getMonth(), anchorDate.getDate() + 7); renderCalendar(); });
        // month navigation removed
        memoSave.addEventListener('click', () => { if (!selectedDateISO) { alert('ë‚ ì§œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”'); return; } setMemo(selectedDateISO, { text: memoText.value, mood: selectedMood }); renderCalendar(); });
        memoClear.addEventListener('click', () => { if (!selectedDateISO) { alert('ë‚ ì§œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”'); return; } setMemo(selectedDateISO, null); memoText.value = ''; renderCalendar(); });

        // Export
        function download(filename, content, type = 'text/plain') { const blob = new Blob([content], { type }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; a.click(); URL.revokeObjectURL(a.href); }
        $('#export-json').addEventListener('click', () => { const data = getMemoMap(); download('mood_diary.json', JSON.stringify(data, null, 2), 'application/json'); });
        $('#export-csv').addEventListener('click', () => { const map = getMemoMap(); const rows = [["date", "mood", "text"]]; Object.keys(map).sort().forEach(k => { const v = getMemo(k); rows.push([k, v.mood || '', (v.text || '').replaceAll('\n', ' ')]); }); const csv = rows.map(r => r.map(x => '"' + x.replaceAll('"', '""') + '"').join(',')).join('\n'); download('mood_diary.csv', csv, 'text/csv'); });

        // Initial
        anchorDate = new Date();
        const now = new Date(); setMood('í–‰ë³µ'); renderCalendar();

        // Code run handlers
        function runUserCode() {
            codeOut.textContent = '';
            const original = console.log;
            try {
                console.log = (...args) => { codeOut.textContent += args.join(' ') + '\n'; };
                new Function(codeText.value)();
            } catch (err) { codeOut.textContent += 'ì—ëŸ¬: ' + err.message; }
            finally { console.log = original; }
        }
        codeRun.addEventListener('click', runUserCode);
        codeClear.addEventListener('click', () => { codeText.value = ''; codeOut.textContent = ''; });
    </script>
</body>
</html>
</html>
